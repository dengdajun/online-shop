layui.define("layer",function(l){var a=layui.jquery,o=layui.layer,p=(layui.device(),"layui-upload-enter"),e="layui-upload-iframe",m={icon:2,shift:6},i={file:"文件",video:"视频",audio:"音频"},n=function(b){this.options=b};n.prototype.init=function(){var g=this,f=g.options,b=a("body"),d=a(f.elem||".layui-upload-file"),c=a('<iframe id="'+e+'" class="'+e+'" name="'+e+'"></iframe>');return a("#"+e)[0]||b.append(c),d.each(function(h,k){k=a(k);var r='<form target="'+e+'" method="'+(f.method||"post")+'" key="set-mine" enctype="multipart/form-data" action="'+(f.url||"")+'"></form>',j=k.attr("lay-type")||f.type;f.unwrap||(r='<div class="layui-box layui-upload-button">'+r+'<span class="layui-upload-icon"><i class="layui-icon">&#xe608;</i>'+(k.attr("lay-title")||f.title||"上传"+(i[j]||"图片"))+"</span></div>"),r=a(r),f.unwrap||r.on("dragover",function(q){q.preventDefault(),a(this).addClass(p)}).on("dragleave",function(){a(this).removeClass(p)}).on("drop",function(){a(this).removeClass(p)}),k.parent("form").attr("target")===e&&(f.unwrap?k.unwrap():(k.parent().next().remove(),k.unwrap().unwrap())),k.wrap(r),k.off("change").on("change",function(){g.action(this,j)})})},n.prototype.action=function(s,c){var f=this,h=f.options,j=s.value,d=a(s),g=d.attr("lay-ext")||h.ext||"";if(j){switch(c){case"file":if(g&&!RegExp("\\w\\.("+g+")$","i").test(escape(j))){return o.msg("不支持该文件格式",m),s.value=""}break;case"video":if(!RegExp("\\w\\.("+(g||"avi|mp4|wma|rmvb|rm|flash|3gp|flv")+")$","i").test(escape(j))){return o.msg("不支持该视频格式",m),s.value=""}break;case"audio":if(!RegExp("\\w\\.("+(g||"mp3|wav|mid")+")$","i").test(escape(j))){return o.msg("不支持该音频格式",m),s.value=""}break;default:if(!RegExp("\\w\\.("+(g||"jpg|png|gif|bmp|jpeg")+")$","i").test(escape(j))){return o.msg("不支持该图片格式",m),s.value=""}}h.before&&h.before(s),d.parent().submit();var k=a("#"+e),b=setInterval(function(){var r;try{r=k.contents().find("body").text()}catch(q){o.msg("上传接口存在跨域",m),clearInterval(b)}if(r){clearInterval(b),k.contents().find("body").html("");try{r=JSON.parse(r)}catch(q){return r={},o.msg("请对上传接口返回JSON字符",m)}"function"==typeof h.success&&h.success(r,s)}},30);s.value=""}},l("upload",function(b){var c=new n(b=b||{});c.init()})});